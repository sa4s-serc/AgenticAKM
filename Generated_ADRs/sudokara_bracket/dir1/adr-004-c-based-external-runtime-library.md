---
### ADR-004: C-Based External Runtime Library

**Status:** Inferred

**Context:** The source language, Racket, likely has features (e.g., dynamic vectors, I/O functions, garbage collection) that do not map directly to primitive machine instructions. The compiled code needs access to a library of pre-written functions to handle these higher-level operations at runtime.

**Decision:** A separate runtime library has been created in C (`tools/runtime/runtime.c`). This library provides functions that the code generated by the compiler can call to perform complex operations. The compiled output is linked against this runtime library to create the final executable.

**Consequences:**
*   **Positive:**
    *   **Simplified Code Generation:** The `CodeGen` phase can emit simple function calls instead of complex inline code for high-level language features.
    *   **Code Reusability:** The same runtime functions can be called from many different places in the compiled code.
    *   **Portability:** The runtime can be written in a highly portable language like C, simplifying the process of targeting new platforms. The compiler itself remains focused on translation logic.
*   **Negative:**
    *   **Language Interoperability:** Requires careful management of the calling convention and data representation between the compiled code and the C runtime.
    *   **Performance:** Function call overhead between the compiled code and the runtime can introduce a performance penalty compared to a fully inlined approach.